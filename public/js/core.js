var starTexture=PIXI.Texture.from("https://pixijs.io/examples/examples/assets/star.png"),humanCannonTexture=PIXI.Texture.from("/img/human-cannon.png"),bulletHeight=15,numberOfInvadersRows=5,starAmount=1E3,bulletSpeed=10,cameraZ=0,fov=20,baseSpeed=.025,speed=0,starStretch=5,starBaseSize=.05,stars=[],aliens=[],alienHitboxes=[],bullets=[],alienTextures=[],humanCannonSprite=new PIXI.Sprite(humanCannonTexture),bulletGraphic=(new PIXI.Graphics).beginFill(16777215).drawRect(100,100,2,bulletHeight).endFill(),
pixelsToGameBorder=(window.innerWidth-600)/2,getNewApp=function(){return new PIXI.Application({width:window.innerWidth,height:window.innerHeight,backgroundColor:0,resolution:1})},app=getNewApp(),bulletTexture=app.renderer.generateTexture(bulletGraphic),getBulletSprite=function(){return new PIXI.Sprite(bulletTexture)},getBulletContainer=function(){var a=new PIXI.Container;a.pivot.y=0;a.sprite=getBulletSprite();a.addChild(a.sprite);return a},createBullet=function(){var a={container:getBulletContainer(),
active:!1,vy:-bulletSpeed};bullets.push(a);app.stage.addChild(a.container);return a},getBullet=function(){var a=bullets.filter(function(a){return!1===a.active});return 0!==a.length?a[0]:createBullet()},getAliveAliens=function(){return aliens.filter(function(a){return!0===a.alive})},initCannonShot=function(a,b){var c=getBullet();c.container.sprite.visible=!0;c.container.x=a;c.container.y=b-bulletHeight-1;c.active=!0},doesBulletInsideAliensContainer=function(a){return a>aliensArmyContainer.y&&a<aliensArmyContainer.y+
aliensArmyContainer.height},moveBullets=function(a){bullets.filter(function(a){return!0===a.active}).forEach(function(a){a.container.y+=a.vy;a.container.y<-bulletHeight?a.active=!1:doesBulletInsideAliensContainer(a.container.y)&&checkBulletState(a)})},doesBulletHitAlienHitbox=function(a,b,c,d){return b.container.x>=a.minX+c&&b.container.x<=a.maxX+c&&b.container.y>=a.minY+d&&b.container.y<=a.maxY+d},checkBulletState=function(a){var b=aliensArmyContainer.x,c=aliensArmyContainer.y;getAliveAliens().forEach(function(d){doesBulletHitAlienHitbox(d.hitbox,
a,b,c)&&killAlien(d,a)})},killAlien=function(a,b){b.active=!1;b.container.sprite.visible=!1;a.sprite.visible=!1;a.alive=!1},randomizeStar=function(a,b){a.z=b?2E3*Math.random():cameraZ+1E3*Math.random()+2E3;b=Math.random()*Math.PI*2;var c=50*Math.random()+1;a.x=Math.cos(b)*c;a.y=Math.sin(b)*c},getInitializedBackground=function(a){for(var b=new PIXI.Container,c=0;c<starAmount;c++){var d={sprite:new PIXI.Sprite(starTexture),z:0,x:0,y:0};d.sprite.anchor.x=.5;d.sprite.anchor.y=.7;randomizeStar(d,!0);b.addChild(d.sprite);
stars.push(d)}a.ticker.add(function(b){speed+=speed/20;cameraZ+=10*b*(speed+baseSpeed);for(b=0;b<starAmount;b++){var c=stars[b];c.z<cameraZ&&randomizeStar(c);var d=c.z-cameraZ;c.sprite.x=fov/d*c.x*a.renderer.screen.width+a.renderer.screen.width/2;c.sprite.y=fov/d*c.y*a.renderer.screen.width+a.renderer.screen.height/2;var f=c.sprite.x-a.renderer.screen.width/2,g=c.sprite.y-a.renderer.screen.height/2,e=Math.sqrt(f*f+g*g);d=Math.max(0,(2E3-d)/2E3);c.sprite.scale.x=d*starBaseSize;c.sprite.scale.y=d*starBaseSize+
d*speed*starStretch*e/a.renderer.screen.width;c.sprite.rotation=Math.atan2(g,f)+Math.PI/2}});return b},keyboard=function(a){var b={};b.name=a;b.isDown=!1;b.isUp=!0;b.press=void 0;b.release=void 0;b.downHandler=function(a){a.key===b.name&&(b.isUp&&b.press&&b.press(),b.isDown=!0,b.isUp=!1);a.preventDefault()};b.upHandler=function(a){a.key===b.name&&(b.isDown&&b.release&&b.release(),b.isDown=!1,b.isUp=!0);a.preventDefault()};window.addEventListener("keydown",b.downHandler.bind(b),!0);window.addEventListener("keyup",
b.upHandler.bind(b),!0);return b},initCannonMovementButtonActions=function(a){var b=keyboard("ArrowLeft"),c=keyboard("ArrowRight");b.press=function(b){return a.vx=-5};b.release=function(b){return a.vx=c.isDown?a.vx:0};c.press=function(b){return a.vx=5};c.release=function(c){return a.vx=b.isDown?a.vx:0}},initCannonShootAbility=function(a){keyboard(" ").release=function(b){return initCannonShot(a.x,a.y)}},cannonShouldStop=function(){return humanCannonContainer.x<=pixelsToGameBorder&&0>humanCannonContainer.vx||
humanCannonContainer.x>=window.innerWidth-pixelsToGameBorder&&0<humanCannonContainer.vx},alienArmyShouldChangeMovementDirection=function(a){return a.x+aliensArmyContainer.x<=pixelsToGameBorder-50&&0>aliensArmyContainer.vx||a.x+aliensArmyContainer.x>=window.innerWidth-pixelsToGameBorder+50&&0<aliensArmyContainer.vx},moveCannon=function(a){cannonShouldStop()||(humanCannonContainer.x+=humanCannonContainer.vx)},getHumanCannonContainer=function(a){var b=new PIXI.Container;b.x=window.innerWidth/2;b.y=window.innerHeight-
50;b.vx=0;humanCannonSprite.anchor.set(.5);humanCannonSprite.scale.set(.5);initCannonMovementButtonActions(b);initCannonShootAbility(b);b.addChild(humanCannonSprite);a.ticker.add(moveCannon);a.ticker.add(moveBullets);return b},getAlienHitbox=function(a){return{minY:a.y,maxY:a.y+a.sprite.height,minX:a.x,maxX:a.x+a.sprite.width}},initAlienHitboxes=function(){aliens.forEach(function(a){return a.hitbox=getAlienHitbox(a)})},getAlienContainer=function(a,b,c){var d={x:a,y:b,alienTypeId:c,alive:!0,state:0,
sprite:new PIXI.Sprite(alienTextures[c][0]),switchSpriteState:function(){d.switchState();d.sprite.texture=alienTextures[d.alienTypeId][d.state]},switchState:function(){d.state=0===d.state?1:0}};d.sprite.scale.set(.3);a=new PIXI.Container;a.x=d.x;a.y=d.y;aliens.push(d);a.addChild(d.sprite);return a},getAlienRowContainer=function(a){var b=0,c=40*a;alienTextures[a]=[PIXI.Texture.from("/img/alien"+a+"-state0.png"),PIXI.Texture.from("/img/alien"+a+"-state1.png")];for(var d=new PIXI.Container,e=0;12>e;e++)d.addChild(getAlienContainer(b,
c,a)),b+=50;return d},getAliensArmyContainer=function(a){a=new PIXI.Container;for(var b=0;b<numberOfInvadersRows;b++)a.addChild(getAlienRowContainer(b));a.x=window.innerWidth/2-a.width/2-15;a.y=100;a.vx=10;return a},background=getInitializedBackground(app),humanCannonContainer=getHumanCannonContainer(app),aliensArmyContainer=getAliensArmyContainer(app);app.stage.addChild(background);app.stage.addChild(humanCannonContainer);app.stage.addChild(aliensArmyContainer);
var moveAliens=function(){var a=!1;getAliveAliens().forEach(function(b){b.switchSpriteState();a||(a=alienArmyShouldChangeMovementDirection(b))});a?(aliensArmyContainer.y+=10,aliensArmyContainer.vx*=-1):aliensArmyContainer.x+=aliensArmyContainer.vx};setInterval(moveAliens,500);setTimeout(initAlienHitboxes,500);document.body.appendChild(app.view);