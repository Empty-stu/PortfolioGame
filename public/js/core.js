var starTexture=PIXI.Texture.from("https://pixijs.io/examples/examples/assets/star.png"),humanCannonTexture=PIXI.Texture.from("/img/human-cannon.png"),starAmount=1E3,cameraZ=0,fov=20,baseSpeed=.025,speed=0,starStretch=5,starBaseSize=.05,stars=[],aliens=[],alienTextures=[],humanCannonSprite=new PIXI.Sprite(humanCannonTexture),pixelsToGameBorder=(window.innerWidth-600)/2,getNewApp=function(){return new PIXI.Application({width:window.innerWidth,height:window.innerHeight,backgroundColor:0,resolution:1})},
randomizeStar=function(b,a){b.z=a?2E3*Math.random():cameraZ+1E3*Math.random()+2E3;a=Math.random()*Math.PI*2;var d=50*Math.random()+1;b.x=Math.cos(a)*d;b.y=Math.sin(a)*d},getInitializedBackground=function(b){for(var a=new PIXI.Container,d=0;d<starAmount;d++){var c={sprite:new PIXI.Sprite(starTexture),z:0,x:0,y:0};c.sprite.anchor.x=.5;c.sprite.anchor.y=.7;randomizeStar(c,!0);a.addChild(c.sprite);stars.push(c)}b.ticker.add(function(a){speed+=speed/20;cameraZ+=10*a*(speed+baseSpeed);for(a=0;a<starAmount;a++){var c=
stars[a];c.z<cameraZ&&randomizeStar(c);var d=c.z-cameraZ;c.sprite.x=fov/d*c.x*b.renderer.screen.width+b.renderer.screen.width/2;c.sprite.y=fov/d*c.y*b.renderer.screen.width+b.renderer.screen.height/2;var f=c.sprite.x-b.renderer.screen.width/2,g=c.sprite.y-b.renderer.screen.height/2,e=Math.sqrt(f*f+g*g);d=Math.max(0,(2E3-d)/2E3);c.sprite.scale.x=d*starBaseSize;c.sprite.scale.y=d*starBaseSize+d*speed*starStretch*e/b.renderer.screen.width;c.sprite.rotation=Math.atan2(g,f)+Math.PI/2}});return a},keyboard=
function(b){var a={};a.name=b;a.isDown=!1;a.isUp=!0;a.press=void 0;a.release=void 0;a.downHandler=function(b){b.key===a.name&&(a.isUp&&a.press&&a.press(),a.isDown=!0,a.isUp=!1);b.preventDefault()};a.upHandler=function(b){b.key===a.name&&(console.log(a.isDown),console.log(a.release?!0:!1),a.isDown&&a.release&&a.release(),a.isDown=!1,a.isUp=!0);b.preventDefault()};window.addEventListener("keydown",a.downHandler.bind(a),!0);window.addEventListener("keyup",a.upHandler.bind(a),!0);return a},initCannonMovementButtonActions=
function(b){var a=keyboard("ArrowLeft"),d=keyboard("ArrowRight");a.press=function(a){return b.vx=-5};a.release=function(a){return b.vx=d.isDown?b.vx:0};d.press=function(a){return b.vx=5};d.release=function(c){return b.vx=a.isDown?b.vx:0}},cannonShouldStop=function(){return humanCannonContainer.x<=pixelsToGameBorder&&0>humanCannonContainer.vx||humanCannonContainer.x>=window.innerWidth-pixelsToGameBorder&&0<humanCannonContainer.vx},moveCannon=function(b){cannonShouldStop()||(humanCannonContainer.x+=
humanCannonContainer.vx)},getHumanCannonContainer=function(b){var a=new PIXI.Container;a.x=window.innerWidth/2;a.y=window.innerHeight-50;a.vx=0;humanCannonSprite.anchor.set(.5);humanCannonSprite.scale.set(.5);initCannonMovementButtonActions(a);a.addChild(humanCannonSprite);b.ticker.add(moveCannon);return a},getAlienContainer=function(b,a,d){var c={x:b,y:a,alienTypeId:d,state:0,sprite:new PIXI.Sprite(alienTextures[d][0]),switchSpriteState:function(){c.switchState();c.sprite.texture=alienTextures[c.alienTypeId][c.state]},
switchState:function(){c.state=0===c.state?1:0}};c.sprite.anchor.set(.5);c.sprite.scale.set(.3);b=new PIXI.Container;b.x=c.x;b.y=c.y;aliens.push(c);b.addChild(c.sprite);return b},getAlienRowContainer=function(b){var a=0,d=40*b;alienTextures[b]=[PIXI.Texture.from("/img/alien"+b+"-state0.png"),PIXI.Texture.from("/img/alien"+b+"-state1.png")];for(var c=new PIXI.Container,e=0;12>e;e++)c.addChild(getAlienContainer(a,d,b)),a+=50;return c},getAliensArmyContainer=function(b){b=new PIXI.Container;for(var a=
0;5>a;a++)b.addChild(getAlienRowContainer(a));b.x=window.innerWidth/2-b.width/2;b.y=100;return b},app=getNewApp(),background=getInitializedBackground(app),humanCannonContainer=getHumanCannonContainer(app),aliensArmyContainer=getAliensArmyContainer(app);app.stage.addChild(background);app.stage.addChild(humanCannonContainer);app.stage.addChild(aliensArmyContainer);setInterval(function(){aliens.forEach(function(b){b.switchSpriteState()})},500);document.body.appendChild(app.view);